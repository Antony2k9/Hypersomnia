---
title: ToDo bugs
hide_sidebar: true
permalink: todo_bugs
summary: Just a hidden scratchpad.
---

- On claarity's server, again a similar bug:
Core was generated by `/home/pbc/Hypersomnia/build/Release-x64-clang/Hypersomnia'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  spatial_properties_mixin<specific_entity_handle<true, shootable_charge, ref_stored_id_provider> >::find_logic_transform() const ()
[Current thread is 1 (Thread 0x7f20599d86c0 (LWP 9553))]
#0  spatial_properties_mixin<specific_entity_handle<true, shootable_charge, ref_stored_id_provider> >::find_logic_transform() const ()
#1  _ZN6cosmic29specific_create_entity_detailI16shootable_charge6cosmosN4augs24trivially_copyable_tupleIJN10components4itemENS5_10rigid_bodyEEEEZNS_21specific_c
lone_entityIS1_EE22specific_entity_handleILb0ET_22ref_stored_id_providerESD_EUlSB_DpOT0_E_EESD_RT0_23typed_entity_flavour_idISB_ERKT1_T2_ ()
#2  just_clone_entity(basic_entity_handle<false>) ()
#3  perform_transfer_impl::operator()(basic_item_slot_transfer_request<entity_id>, cosmos&) const ()
#4  perform_transfer(basic_item_slot_transfer_request<entity_id>, basic_logic_step<false>) ()
#5  gun_system::launch_shots_due_to_pressed_triggers(basic_logic_step<false>) ()
#6  standard_solve(basic_logic_step<false>) ()
#7  _ZNSt3__116__variant_detail12__visitation6__base12__dispatcherIJLm0EEE10__dispatchB6v15007IONS1_9__variant15__value_visitorIZN18basic_arena_handleILb0E20bas
ic_mode_and_rulesINS_7variantIJ12bomb_defusal9test_modeEEEEE23on_mode_with_input_implIKSF_ZNKSF_7advanceIJRK12mode_entropyR18solver_callbacks_tI14empty_callback
ZN12client_setup19advance_single_stepISM_IZ4workiPKPKcE4$_36ZZ4workiST_ENK4$_37clISO_EEDaPKN4augs14audio_rendererENSX_5deltaERT_RK17input_pass_resultEUl16basic_
logic_stepILb1EE31audiovisual_post_solve_settingsE_ZZ4workiST_ENKSW_ISO_EEDaS10_S11_S13_S16_EUlRKS18_E_EZNSO_7advanceIS1E_EEvRK20client_advance_inputRKS12_EUlvE
1_ZNS1F_IS1E_EEvS1I_S1K_EUlvE0_EEvS1I_S1K_T0_T1_EUlS18_E0_SN_ERK14solve_settingsEEEDcDpOT_EUlS13_RKS1N_E_EEDcS13_OS1N_EUlS13_E_EEJRNS0_6__baseILNS0_6_TraitE1EJS
B_SC_EEEEEEDcS12_DpT0_ ()
#8  _ZNSt3__116__variant_detail12__visitation6__base12__dispatcherIJLm3EEE10__dispatchB6v15007IONS1_9__variant15__value_visitorIZZ4workiPKPKcENK3$_2clIZZ4workiS
B_ENK4$_35clEPKN4augs14audio_rendererENSF_5deltaERK17input_pass_resultEUlRT_E_EEDcSN_EUlSO_E_EEJRNS0_6__baseILNS0_6_TraitE1EJ16test_scene_setup12editor_setup22p
roject_selector_setup12client_setup12server_setupEEEEEEDcSN_DpT0_ ()
#9  work(int, char const* const*)::$_39::operator()() const::{lambda()#1}::operator()() const ()
#10 void* std::__1::__thread_proxy[abi:v15007]<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struc
t> >, work(int, char const* const*)::$_39> >(void*) ()
#11 ?? () from /usr/lib/libc.so.6
#12 ?? () from /usr/lib/libc.so.6

- Weapon collider is fucked when it's in the other hand

- Desync with hajt
	- Try playing it on windows
	- Happens when damage is dealt for some reason
		- couldnt physics break at these bullet speeds?
	- Perhaps rapidjson is a source of indeterminism when loading doubles/floats
- The desync happened with claarity too on a very simple map so it makes me think it's an issue with how it's loaded from json

- Crash due to yojimbo_assert( sentPacket );
	- Only in debug build though
	- This doesn't really break anything if we just comment it out and let it go
		- this is basically because we don't send any packets on all the other channels for a while so they have m_sequence = 0, and they are suddenly greeted with a very large sequence number
		- the question being, if it's not inserted into the sequence buffer, how the hell is it even getting acked
			- so why does this just work?
		LOG_NVPS(sequence,m_sentPackets->GetSequence(), m_sentPackets->GetSize());
	- looks like the sequence number is increased by just acking the fragments, it won't help to withhold file requests


- when quick testing arena5, probably due to item deletion?
Program terminated with signal SIGSEGV, Segmentation fault.
#0  spatial_properties_mixin<specific_entity_handle<true, shootable_charge, ref_stored_id_provider> >::find_logic_transform() const ()
[Current thread is 1 (Thread 0x7f6243fff6c0 (LWP 84381))]
#0  spatial_properties_mixin<specific_entity_handle<true, shootable_charge, ref_stored_id_provider> >::find_logic_transform() const ()
#1  _ZN6cosmic29specific_create_entity_detailI16shootable_charge6cosmosN4augs24trivially_copyable_tupleIJN10components4itemENS5_10rigid_bodyEEEEZNS_21specific_c
lone_entityIS1_EE22specific_entity_handleILb0ET_22ref_stored_id_providerESD_EUlSB_DpOT0_E_EESD_RT0_23typed_entity_flavour_idISB_ERKT1_T2_ ()
#2  just_clone_entity(basic_entity_handle<false>) ()
#3  perform_transfer_impl::operator()(basic_item_slot_transfer_request<entity_id>, cosmos&) const ()
#4  perform_transfer(basic_item_slot_transfer_request<entity_id>, basic_logic_step<false>) ()
#5  gun_system::launch_shots_due_to_pressed_triggers(basic_logic_step<false>) ()
#6  standard_solve(basic_logic_step<false>) ()
#7  _ZNSt3__116__variant_detail12__visitation6__base12__dispatcherIJLm1EEE10__dispatchB6v15007IONS1_9__variant15__value_visitorIZN18basic_arena_handleILb0E20bas
ic_mode_and_rulesINS_7variantIJ12bomb_defusal9test_modeEEEEE23on_mode_with_input_implIKSF_ZNKSF_7advanceIJRK12mode_entropyR18solver_callbacks_tIZ4workiPKPKcE4$_
36ZZNKSM_ISR_ZZ4workiSQ_ENK4$_37clI12server_setupEEDaPKN4augs14audio_rendererENSV_5deltaERT_RK17input_pass_resultEUl16basic_logic_stepILb1EE31audiovisual_post_s
olve_settingsE_ZZ4workiSQ_ENKST_ISU_EEDaSY_SZ_S11_S14_EUlRKS16_E_E7combineI14empty_callbackRZNSU_7advanceIS1C_EEvRK20server_advance_inputRKS10_EUlS10_S16_E0_S1E
_EEDaOS10_OT0_OT1_ENKUlS10_S1O_E_clIS1L_S18_EEDaS10_S1O_EUlDpOT_E_S1B_E14solve_settingsEEEDcS1W_EUlS11_RKS1O_E_EEDcS11_S1P_EUlS11_E_EEJRNS0_6__baseILNS0_6_Trait
E1EJSB_SC_EEEEEEDcS10_DpT0_ ()
#8  _ZNSt3__116__variant_detail12__visitation6__base12__dispatcherIJLm4EEE10__dispatchB6v15007IONS1_9__variant15__value_visitorIZZ4workiPKPKcENK3$_2clIZZ4workiS
B_ENK4$_35clEPKN4augs14audio_rendererENSF_5deltaERK17input_pass_resultEUlRT_E_EEDcSN_EUlSO_E_EEJRNS0_6__baseILNS0_6_TraitE1EJ16test_scene_setup12editor_setup22p
roject_selector_setup12client_setup12server_setupEEEEEEDcSN_DpT0_ ()
#9  work(int, char const* const*)::$_39::operator()() const::{lambda()#1}::operator()() const ()
#10 void* std::__1::__thread_proxy[abi:v15007]<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struc
t> >, work(int, char const* const*)::$_39> >(void*) ()
#11 ?? () from /usr/lib/libc.so.6
#12 ?? () from /usr/lib/libc.so.6

We have a demo file


- don't autolaunch on the replayed demo!!!!! because it might crash

- on de_duel_practice, we had an openal error because of a reseek_to_sync_if_needed on a warmup theme
	- alSourcef was called with an out of range value, but I'm not sure how it's possible since we clamp the value always to the duration
	- However simply setting stop (stop is always valid for a source) fixes the issue for now, but I'm not sure how it happened in the first place

- crash on bigilab: we should be able to reproduce it with a demo on windows

- linux bug: neon silhouettes can be seen behind player, probably something to do with drivers
	- It's a problem with gl_FragCoord: probably stencil on another fbo is somehow flipped
	- To reverse the problem, one can put the following in fog_of_war.fsh: layout(origin_upper_left) in vec4 gl_FragCoord; 
		- although only with higher glsl version
	- didn't happen before, very probable it's a driver bug

- Fixing wallbangs and wall teleportation
    - A short raycast sensor in front of the player
        - Detect all convex shapes of walls in front of him
        - Just take all vertices of all detected convexes
        - And create a single trapezoid body
    - Don't do raycast
        - simply query the  right before the physics step (after applying the crosshair's direction to player rotation)

- There was a crash due to dead entity in driver setup finding a component
	- possible cause is that the gun system destroys item in chamber, but technically they should not trigger END_CONTACT
	as they are devoid of... hey, actually that might be because we still see those entities even if they are in backpack. 
	In that case, if the owner body of an item chamber is badly determined, it might make sense that it crashes
	- ensure that the posted subject in contact listener is alive, but that is most likely the case since we get physical components from them anyway
		- but ensures won't hurt

# Disregarded

- Investigate the mysterious hotbar crash
	- Happened when we finished drag and dropping on hotbar 
	- All buttons on hotbar were assigned
	- The item we dragged was hidden in backpack and *possibly* unassigned to hotbar yet
	- NEW: The crash happened EXACTLY when pressing an AWP that was in the backpack
		- But it was presuambly not in the hotbar since we pressed it
	- haven't seen for a while and inventory will be reworked anyway

- NAT traversal does not always work with our symmetric port-sensitive
	- Working connections:
		- filemon -> Billan
		- Pythagoras <-> Billan
		- Pythagoras <-> Shuncio
		- Pythagoras -> cold dimensions
		- Pythagoras -> Wojteg
	- Not working:
		- filemon <-> Pythagoras
	- not so important, and it's from a long time ago, generally it works if the nat does not randomize ports

- GCC relwithdebinfo does not properly set the physical shapes
	 - ?


- Possibly disallow some editor ops when in gameplay/gui mode?
	- E.g. there was a crash after instantiating cause the world cursor pos could not be found in gameplay mode
	- new editor will solve this

- fix freetype charsets
	- ?

# Done

- all_necessary_sounds might cause a crash on destruct too

- remember to fix your system time before hosting
	- fix that damn connect token

- wrong interpolation values in client setup
	- But somehow only for fy_minilab
		- It was probably generated with 128 so the solvable might still have 128 written into it
		- but only predicted cosmos sometimes shows 128, referential always has 60
			- how is it possible if the only source of state for predicted is the referential?
				- maybe referential is somehow updated later? And predicted is only rewritten on mismatch afaik
				- yeah first both are read from disk, only then is initial state applied
					- after reading from disk both should have 128
					- then upon receiving initial, is predicted properly set to 60?
- warmup not played when switching maps sometimes and still spectating (in release)
	- solved, due to the above

- Wandering pixels crash
	- Fixed by eliminating Data race, see the comments in audiovisual_state.cpp

- Server crash from 11.01.2023 at 01:24 - fixed with *11b30d931246caa7e0cce04d7e83756eb33acd53*
	- Kartezjan then najsilniejszy programista C++
	- It crashed before successfully sending the message to Telegram but after successfully sending the Discord one
	- Actually rather peculiar, if both lived enough for the discord message to be properly sent, there's no reason telegram one wouldn't eventually arrive, must've been problem elsewhere 
		- I've also seen kartezjan for a bit so it must've sent me some data
	- Maybe httplib is not actually thread safe
		- Just in case I'd update it and merge the two webhook handlers into a single lambda

- Enabling HRTF in debug mode crashes the game but there's no core or segfault or anything
	- it just quits
	- Fixed by updating OpenAL

- Server sent entropy too early?
    - server wasn't pausing the solvable stream for downloading clients when sending entropies
- TLSF crashes after sending 9 files
    - Maybe we're not freeing the blocks properly
    - Probably an issue with tlsf, wouldn't be surprised if it was because of differing sizes for files, at least one block was remaining per each size
        - which is why we need to use default allocator for our block messages because their sizes will be nondeterministic
            - this will also free our per-client memory

- demo files might be fucked up during sessions with downloaded maps
	- they must correctly remember the full state snapshots
	- It was just a matter of ignoring file payloads

